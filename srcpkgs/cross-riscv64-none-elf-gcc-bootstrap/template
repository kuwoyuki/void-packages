# Template file for 'cross-riscv64-none-elf-gcc-bootstrap'
pkgname=cross-riscv64-none-elf-gcc-bootstrap
version=14.2.0
revision=1
_triplet=riscv64-none-elf
wrksrc="gcc-${version}"
build_wrksrc="build"
build_style=gnu-configure
configure_script="../configure"

short_desc="GNU Compiler Collection - cross compiler for RISC-V target (bootstrap)"
maintainer="Miraris <miraris@autistici.org>"
license="GFDL-1.2-or-later, GPL-3.0-or-later, LGPL-2.1-or-later"
homepage="http://gcc.gnu.org"
distfiles="${GNU_SITE}/gcc/gcc-${version}/gcc-${version}.tar.xz"
checksum="a7b39bc69cbf9e25826c5a60ab26477001f7c08d85cec04bc0e29cabed6f3cc9"

hostmakedepends="tar flex cross-${_triplet}-binutils"
makedepends="zlib-devel libmpc-devel"
depends="cross-${_triplet}-binutils"

nopie=yes
lib32disabled=yes
nocross=yes
nostrip=yes
bootstrap=yes

configure_args="
 --prefix=/usr
 --libdir=/usr/lib
 --libexecdir=/usr/lib
 --target=${_triplet}
 --with-sysroot=/usr/${_triplet}
 --with-local-prefix=/usr/${_triplet}
 --with-build-sysroot=/usr/${_triplet}
 --with-newlib
 --without-headers
 --disable-shared
 --disable-threads
 --disable-libmudflap
 --disable-libssp
 --disable-libquadmath
 --disable-libgomp
 --disable-nls
 --disable-werror
 --disable-libatomic
 --disable-gcov
 --disable-bootstrap
 --enable-languages=c
 --enable-checking=release
 --enable-multilib
 --enable-tls
 --with-system-zlib"

post_extract() {
	mkdir -p ${wrksrc}/build
}

pre_configure() {
	unset CFLAGS CXXFLAGS LDFLAGS
	export CFLAGS="-O2"
}

do_build() {
	make ${makejobs} all-gcc
	make ${makejobs} inhibit-libc=true all-target-libgcc
}

do_install() {
	make DESTDIR=${DESTDIR} inhibit-libc=true install-gcc
	make DESTDIR=${DESTDIR} inhibit-libc=true install-target-libgcc
}

post_install() {
	rm -rf ${DESTDIR}/usr/share/man/man7
	rm -rf ${DESTDIR}/usr/share/info
	rm -rf ${DESTDIR}/usr/lib/libcc1.*
}